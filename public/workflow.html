<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Program Factory - Workflow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .workflow-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            padding: 10px;
            position: relative;
        }

        .progress-step.active {
            color: #667eea;
            font-weight: bold;
        }

        .progress-step.completed {
            color: #28a745;
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .route-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .route-card {
            padding: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .route-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .route-card.selected {
            border-color: #667eea;
            background: #f0f3ff;
        }

        .route-card h3 {
            margin-bottom: 10px;
            color: #667eea;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .session-list {
            list-style: none;
        }

        .session-item {
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .session-item:hover {
            background: #e9ecef;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .btn-example {
            background: #17a2b8;
            color: white;
            padding: 8px 16px;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .btn-example:hover {
            background: #138496;
        }

        .helper-text {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 4px;
            font-style: italic;
        }

        .example-download {
            display: inline-block;
            margin: 15px 0;
            padding: 10px 15px;
            background: #e7f3ff;
            border: 1px dashed #667eea;
            border-radius: 6px;
            color: #667eea;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .example-download:hover {
            background: #d0e7ff;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
            padding: 6px 12px;
            font-size: 0.85rem;
            margin-left: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .session-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .session-info {
            flex: 1;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AI Program Factory</h1>
            <p>Human-Guided Workflow System</p>
        </div>

        <div class="workflow-container">
            <!-- Progress Bar -->
            <div class="progress-bar" id="progress-bar">
                <div class="progress-step active" data-step="brief">Client Brief</div>
                <div class="progress-step" data-step="route">Route Selection</div>
                <div class="progress-step" data-step="prepare">Preparation</div>
                <div class="progress-step" data-step="matrix">Program Matrix</div>
                <div class="progress-step" data-step="sample">Sample Article</div>
                <div class="progress-step" data-step="complete">Complete</div>
            </div>

            <!-- Loading Indicator -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Processing...</p>
            </div>

            <!-- Step 1: Sessions List / New Session -->
            <div class="step-content active" id="step-sessions">
                <h2>Your Workflow Sessions</h2>
                <button class="btn btn-primary" onclick="showNewSessionForm()">Create New Session</button>
                <ul class="session-list" id="session-list"></ul>
            </div>

            <!-- Step 2: Client Brief -->
            <div class="step-content" id="step-brief">
                <h2>Client Brief
                    <button type="button" class="btn btn-example" onclick="fillExampleBrief()">Fill Example</button>
                </h2>
                <form id="brief-form">
                    <div class="form-group">
                        <label for="clientName">Client Name</label>
                        <input type="text" id="clientName" required placeholder="e.g., Acme Corporation">
                        <div class="helper-text">Enter the name of your client or organization</div>
                    </div>
                    <div class="form-group">
                        <label for="industry">Industry</label>
                        <input type="text" id="industry" required placeholder="e.g., Healthcare, Technology, Finance">
                        <div class="helper-text">What industry is this training for?</div>
                    </div>
                    <div class="form-group">
                        <label for="objectives">Learning Objectives (one per line)</label>
                        <textarea id="objectives" rows="4" placeholder="Understand HIPAA compliance requirements&#10;Apply data privacy best practices&#10;Recognize potential security threats"></textarea>
                        <div class="helper-text">What should learners be able to do after completing this training?</div>
                    </div>
                    <div class="form-group">
                        <label for="audience">Target Audience</label>
                        <input type="text" id="audience" placeholder="e.g., Healthcare professionals, IT staff">
                        <div class="helper-text">Who will be taking this training?</div>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Brief</button>
                </form>
            </div>

            <!-- Step 3: Route Selection -->
            <div class="step-content" id="step-route">
                <h2>Select Workflow Route</h2>
                <div class="route-options">
                    <div class="route-card" onclick="selectRoute('A')">
                        <h3>Route A: Convert Existing Materials</h3>
                        <p>You have existing course materials, documentation, or reference materials that need to be reformatted for your platform.</p>
                        <ul>
                            <li>Upload existing materials</li>
                            <li>Extract and reformat content</li>
                            <li>Faster process</li>
                        </ul>
                    </div>
                    <div class="route-card" onclick="selectRoute('B')">
                        <h3>Route B: Create from Research</h3>
                        <p>Build learning content from scratch using AI research in your field.</p>
                        <ul>
                            <li>AI field research</li>
                            <li>Alternative approaches</li>
                            <li>Fresh content creation</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Step 4A: File Upload (Route A) -->
            <div class="step-content" id="step-upload">
                <h2>Upload Existing Materials</h2>
                <p style="margin-bottom: 20px;">Upload your existing course materials, training documents, or reference materials. We'll extract the content and help you reformat it.</p>

                <a href="#" class="example-download" onclick="downloadSampleFile(); return false;">
                    📥 Download Sample Training Document
                </a>

                <div class="form-group">
                    <label for="fileUpload">Upload Files (PDF, DOCX, TXT, MD)</label>
                    <input type="file" id="fileUpload" multiple accept=".pdf,.docx,.txt,.md">
                    <div class="helper-text">You can select multiple files (Max 10MB per file)</div>
                </div>
                <button class="btn btn-primary" onclick="handleFileUpload()">Process Files</button>
            </div>

            <!-- Step 4B: Research Input (Route B) -->
            <div class="step-content" id="step-research">
                <h2>Field Research</h2>
                <p style="margin-bottom: 20px;">We'll research the latest learning approaches and methodologies for your industry using AI.</p>

                <div class="helper-text" style="padding: 15px; background: #f8f9fa; border-radius: 6px; margin-bottom: 20px;">
                    <strong>What happens next:</strong>
                    <ul style="margin: 10px 0 0 20px;">
                        <li>AI will research current best practices in your industry</li>
                        <li>You'll receive 2-3 different learning approach recommendations</li>
                        <li>You'll choose the approach that best fits your needs</li>
                    </ul>
                </div>

                <div id="research-results"></div>
                <button class="btn btn-primary" onclick="conductResearch()">Start AI Research</button>
            </div>

            <!-- Step 5: Matrix Generation (Placeholder) -->
            <div class="step-content" id="step-matrix">
                <h2>Program Matrix Generation</h2>
                <div style="padding: 30px; text-align: center; background: #f8f9fa; border-radius: 8px;">
                    <h3 style="color: #667eea;">✅ Files Processed Successfully!</h3>
                    <p style="margin: 20px 0;">Your content has been extracted and analyzed.</p>
                    <div style="background: white; padding: 20px; border-radius: 6px; margin: 20px 0; text-align: left;">
                        <h4>Next Steps (Coming in Week 3):</h4>
                        <ul style="margin: 10px 0 0 20px;">
                            <li>AI will generate a program matrix structure</li>
                            <li>You'll review and approve the structure</li>
                            <li>Sample content will be generated for review</li>
                            <li>Full batch content generation upon approval</li>
                        </ul>
                    </div>
                    <p style="color: #6c757d;">This feature is currently under development as part of Week 3 implementation.</p>
                    <button class="btn btn-secondary" onclick="showStep('sessions')" style="margin-top: 20px;">
                        Return to Sessions
                    </button>
                </div>
            </div>

            <!-- Success Message -->
            <div id="message-container"></div>
        </div>
    </div>

    <script>
        let currentSessionId = null;
        let currentStep = 'sessions';

        // Load sessions on page load
        window.addEventListener('load', loadSessions);

        async function loadSessions() {
            try {
                const response = await fetch('/api/workflow');
                const sessions = await response.json();
                displaySessions(sessions);
            } catch (error) {
                console.error('Error loading sessions:', error);
            }
        }

        function displaySessions(sessions) {
            const list = document.getElementById('session-list');
            if (sessions.length === 0) {
                list.innerHTML = '<li style="padding: 20px; text-align: center; color: #666;">No sessions yet. Create one to get started.</li>';
                return;
            }

            list.innerHTML = sessions.map(session => `
                <li class="session-item">
                    <div class="session-info" onclick="loadSession('${session.id}')">
                        <strong>${session.client_name}</strong> - ${session.industry}
                        <br>
                        <small>Status: ${session.status} | Step: ${session.current_step}</small>
                    </div>
                    <button class="btn-delete" onclick="deleteSession('${session.id}', event)">Delete</button>
                </li>
            `).join('');
        }

        function showNewSessionForm() {
            currentSessionId = null;
            showStep('brief');
        }

        async function deleteSession(sessionId, event) {
            // Prevent triggering the parent onclick
            if (event) {
                event.stopPropagation();
            }

            if (!confirm('Are you sure you want to delete this session? This cannot be undone.')) {
                return;
            }

            showLoading(true);

            try {
                const response = await fetch(`/api/workflow/${sessionId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showMessage('Session deleted successfully!', 'success');
                    // Reload sessions list
                    await loadSessions();
                } else {
                    const data = await response.json();
                    showMessage(data.error || 'Error deleting session', 'error');
                }
            } catch (error) {
                console.error('Error deleting session:', error);
                showMessage('Error deleting session: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function loadSession(sessionId) {
            try {
                const response = await fetch(`/api/workflow/${sessionId}`);
                const data = await response.json();
                currentSessionId = sessionId;
                showStep(data.session.current_step);
            } catch (error) {
                console.error('Error loading session:', error);
                showMessage('Error loading session', 'error');
            }
        }

        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));

            // Show current step
            const stepMap = {
                'brief': 'step-brief',
                'route_selection': 'step-route',
                'route_a_upload': 'step-upload',
                'route_b_research': 'step-research',
                'approach_selection': 'step-research', // Stay on research step for approach selection
                'matrix_generation': 'step-matrix',
                'sessions': 'step-sessions'
            };

            const stepId = stepMap[step] || 'step-sessions';
            document.getElementById(stepId).classList.add('active');
        }

        document.getElementById('brief-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const brief = {
                clientName: document.getElementById('clientName').value,
                industry: document.getElementById('industry').value,
                objectives: document.getElementById('objectives').value.split('\n').filter(o => o.trim()),
                audience: document.getElementById('audience').value
            };

            showLoading(true);

            try {
                const response = await fetch('/api/workflow', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(brief)
                });

                const data = await response.json();
                currentSessionId = data.sessionId;
                showMessage('Brief saved successfully!', 'success');
                showStep('route_selection');
            } catch (error) {
                console.error('Error saving brief:', error);
                showMessage('Error saving brief', 'error');
            } finally {
                showLoading(false);
            }
        });

        async function selectRoute(route) {
            if (!currentSessionId) {
                showMessage('Please create a session first', 'error');
                return;
            }

            showLoading(true);

            try {
                const response = await fetch(`/api/workflow/${currentSessionId}/route`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ route })
                });

                const data = await response.json();
                showMessage(`Route ${route} selected!`, 'success');
                showStep(data.nextStep);
            } catch (error) {
                console.error('Error selecting route:', error);
                showMessage('Error selecting route', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function handleFileUpload() {
            const fileInput = document.getElementById('fileUpload');
            const files = fileInput.files;

            if (files.length === 0) {
                showMessage('Please select files to upload', 'error');
                return;
            }

            showLoading(true);

            try {
                // Use FormData to send actual files
                const formData = new FormData();
                for (let i = 0; i < files.length; i++) {
                    formData.append('files', files[i]);
                }

                const response = await fetch(`/api/workflow/${currentSessionId}/upload`, {
                    method: 'POST',
                    body: formData
                    // Note: Don't set Content-Type header, browser will set it with boundary
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage(`Files uploaded successfully! Processed ${data.filesCount} files.`, 'success');
                    // Move to next step based on response
                    if (data.nextStep) {
                        setTimeout(() => showStep(data.nextStep), 2000);
                    }
                } else {
                    showMessage(data.error || 'Error uploading files', 'error');
                }
            } catch (error) {
                console.error('Error uploading files:', error);
                showMessage('Error uploading files: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function conductResearch() {
            if (!currentSessionId) return;

            showLoading(true);

            try {
                const response = await fetch(`/api/workflow/${currentSessionId}/research`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();

                if (response.ok) {
                    // Display research results
                    displayResearchResults(data.research);
                    showMessage('Research completed! Review the approaches below.', 'success');
                } else {
                    showMessage(data.error || 'Error conducting research', 'error');
                }
            } catch (error) {
                console.error('Error conducting research:', error);
                showMessage('Error conducting research: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        function displayResearchResults(research) {
            const container = document.getElementById('research-results');

            let html = '<div style="margin: 20px 0;">';
            html += '<h3>Latest Developments</h3>';
            html += '<ul>';
            research.latestDevelopments.forEach(dev => {
                html += `<li>${dev}</li>`;
            });
            html += '</ul>';

            html += '<h3 style="margin-top: 20px;">Recommended Approaches</h3>';
            research.approaches.forEach((approach, index) => {
                const isRecommended = approach.id === research.recommendation.approachId;
                html += `
                    <div style="border: 2px solid ${isRecommended ? '#667eea' : '#e1e5e9'};
                                padding: 15px; margin: 15px 0; border-radius: 8px;
                                background: ${isRecommended ? '#f0f3ff' : 'white'};">
                        <h4 style="color: #667eea;">${approach.name} ${isRecommended ? '⭐ Recommended' : ''}</h4>
                        <p>${approach.description}</p>
                        <p><strong>Methodology:</strong> ${approach.methodology}</p>
                        <p><strong>Best for:</strong> ${approach.bestFor.join(', ')}</p>
                        <button class="btn btn-primary" style="margin-top: 10px;"
                                onclick="selectApproach('${approach.id}')">
                            Select This Approach
                        </button>
                    </div>
                `;
            });
            html += '</div>';

            container.innerHTML = html;
        }

        async function selectApproach(approachId) {
            if (!currentSessionId) return;

            showLoading(true);

            try {
                const response = await fetch(`/api/workflow/${currentSessionId}/approach`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ approach: approachId })
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage('Approach selected! Moving to next step...', 'success');
                    if (data.nextStep) {
                        setTimeout(() => showStep(data.nextStep), 2000);
                    }
                } else {
                    showMessage(data.error || 'Error selecting approach', 'error');
                }
            } catch (error) {
                console.error('Error selecting approach:', error);
                showMessage('Error selecting approach: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('active', show);
        }

        function showMessage(message, type) {
            const container = document.getElementById('message-container');
            const className = type === 'error' ? 'error-message' : 'success-message';
            container.innerHTML = `<div class="${className}">${message}</div>`;
            setTimeout(() => container.innerHTML = '', 5000);
        }

        // Fill example brief data
        function fillExampleBrief() {
            document.getElementById('clientName').value = 'TechCorp Industries';
            document.getElementById('industry').value = 'Healthcare Technology';
            document.getElementById('objectives').value = `Understand HIPAA compliance requirements
Apply data privacy and security best practices
Recognize and respond to potential security threats
Implement secure patient data handling procedures`;
            document.getElementById('audience').value = 'Healthcare IT professionals and administrators';
            showMessage('Example data filled! You can edit it before saving.', 'success');
        }

        // Download sample training document
        function downloadSampleFile() {
            const sampleContent = `HEALTHCARE IT SECURITY TRAINING MATERIALS

Module 1: HIPAA Compliance Fundamentals

Overview:
The Health Insurance Portability and Accountability Act (HIPAA) establishes national standards for protecting sensitive patient health information. This module covers the key requirements and best practices for HIPAA compliance in healthcare IT systems.

Learning Objectives:
- Understand the core requirements of HIPAA Privacy and Security Rules
- Identify Protected Health Information (PHI) in various contexts
- Implement appropriate safeguards for electronic PHI (ePHI)

Key Concepts:

1. Protected Health Information (PHI)
   - Any individually identifiable health information
   - Includes demographic data, medical histories, test results, insurance information
   - Must be protected whether transmitted, stored, or maintained

2. HIPAA Security Rule Requirements
   - Administrative safeguards: policies, procedures, training
   - Physical safeguards: facility access controls, workstation security
   - Technical safeguards: access controls, encryption, audit controls

3. Risk Assessment
   - Regular evaluation of potential risks to ePHI
   - Documentation of security measures
   - Continuous monitoring and updating

Best Practices:
- Use strong authentication and access controls
- Encrypt data in transit and at rest
- Maintain detailed audit logs
- Conduct regular security awareness training
- Implement incident response procedures

Module 2: Data Privacy Best Practices

Overview:
Effective data privacy goes beyond compliance to build trust with patients and protect organizational reputation. This module explores practical strategies for maintaining data privacy in healthcare settings.

Key Topics:
- Minimum necessary standard
- Authorization and consent procedures
- Breach notification requirements
- Vendor management and Business Associate Agreements

Practical Scenarios:
1. Email Security: When can PHI be sent via email? What safeguards are required?
2. Mobile Devices: How to secure PHI on smartphones and tablets
3. Remote Access: Best practices for telehealth and remote work

Module 3: Security Threat Recognition

Common Threats:
- Phishing attacks targeting healthcare credentials
- Ransomware attacks on medical facilities
- Insider threats and unauthorized access
- Lost or stolen devices containing PHI

Response Procedures:
1. Immediate containment of suspected breaches
2. Notification to security team and compliance officer
3. Documentation of incident details
4. Investigation and remediation
5. Notification to affected individuals if required

Assessment Questions:
1. What constitutes a HIPAA violation?
2. How should you respond to a suspected data breach?
3. What are the penalties for non-compliance?

Additional Resources:
- HHS Office for Civil Rights guidance
- NIST Cybersecurity Framework
- Healthcare-specific security standards`;

            const blob = new Blob([sampleContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sample-healthcare-training.txt';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            showMessage('Sample file downloaded! You can upload it in the next step.', 'success');
        }
    </script>
</body>
</html>
