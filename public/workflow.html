<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Program Factory - Workflow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .workflow-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            padding: 10px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 6px;
        }

        .progress-step:hover {
            background: #e9ecef;
        }

        .progress-step.active {
            color: #667eea;
            font-weight: bold;
            background: #f0f3ff;
        }

        .progress-step.completed {
            color: #28a745;
        }

        .progress-step.completed::after {
            content: "✓";
            margin-left: 5px;
            font-weight: bold;
        }

        .progress-step.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-step.disabled:hover {
            background: transparent;
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-back {
            background: #e9ecef;
            color: #495057;
            padding: 10px 20px;
            margin-right: 10px;
        }

        .btn-back:hover {
            background: #dee2e6;
            transform: none;
            box-shadow: none;
        }

        .navigation-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e1e5e9;
        }

        .route-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .route-card {
            padding: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .route-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .route-card.selected {
            border-color: #667eea;
            background: #f0f3ff;
        }

        .route-card h3 {
            margin-bottom: 10px;
            color: #667eea;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .session-list {
            list-style: none;
        }

        .session-item {
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .session-item:hover {
            background: #e9ecef;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .btn-example {
            background: #17a2b8;
            color: white;
            padding: 8px 16px;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .btn-example:hover {
            background: #138496;
        }

        .helper-text {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 4px;
            font-style: italic;
        }

        .example-download {
            display: inline-block;
            margin: 15px 0;
            padding: 10px 15px;
            background: #e7f3ff;
            border: 1px dashed #667eea;
            border-radius: 6px;
            color: #667eea;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .example-download:hover {
            background: #d0e7ff;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
            padding: 6px 12px;
            font-size: 0.85rem;
            margin-left: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .session-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .session-info {
            flex: 1;
            cursor: pointer;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .matrix-session {
            border: 1px solid #e1e5e9;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            background: white;
        }

        .matrix-session h4 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .matrix-session ul {
            margin: 10px 0 10px 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AI Program Factory</h1>
            <p>Human-Guided Workflow System</p>
            <p style="margin-top: 10px;">
                <a href="/prompts.html" style="color: white; text-decoration: underline; opacity: 0.9;">⚙️ Manage Prompts</a>
            </p>
        </div>

        <div class="workflow-container">
            <!-- Progress Bar -->
            <div class="progress-bar" id="progress-bar">
                <div class="progress-step" data-step="brief" data-target="brief" onclick="navigateToStep('brief')">Client Brief</div>
                <div class="progress-step disabled" data-step="route" data-target="route_selection" onclick="navigateToStep('route_selection')">Route Selection</div>
                <div class="progress-step disabled" data-step="prepare" data-target="content_review" onclick="navigateToStep('content_review')">Preparation</div>
                <div class="progress-step disabled" data-step="matrix" data-target="matrix_review" onclick="navigateToStep('matrix_review')">Program Matrix</div>
                <div class="progress-step disabled" data-step="sample" data-target="sample_validation" onclick="navigateToStep('sample_validation')">Sample Article</div>
                <div class="progress-step disabled" data-step="complete" data-target="completed" onclick="navigateToStep('completed')">Complete</div>
            </div>

            <!-- Loading Indicator -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Processing...</p>
            </div>

            <!-- Step 1: Sessions List / New Session -->
            <div class="step-content active" id="step-sessions">
                <h2>Your Workflow Sessions</h2>
                <button class="btn btn-primary" onclick="showNewSessionForm()">Create New Session</button>
                <ul class="session-list" id="session-list"></ul>
            </div>

            <!-- Step 2: Client Brief -->
            <div class="step-content" id="step-brief">
                <h2>Client Brief
                    <button type="button" class="btn btn-example" onclick="fillExampleBrief()">Fill Example</button>
                </h2>

                <div style="background: #f0f3ff; padding: 15px; border-radius: 6px; margin-bottom: 20px; border: 2px solid #667eea;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">📄 Upload Briefing Document (Optional)</h4>
                    <p style="margin-bottom: 10px; font-size: 0.9rem;">If you have a completed briefing interview document, upload it here. We'll extract the information automatically.</p>
                    <input type="file" id="briefDocument" accept=".pdf,.docx,.txt,.md" style="margin-bottom: 10px;">
                    <button type="button" class="btn btn-secondary" onclick="uploadBriefDocument()" style="font-size: 0.9rem;">Upload & Auto-Fill</button>
                </div>

                <form id="brief-form">
                    <h3 style="margin-bottom: 15px; color: #667eea;">Basic Information</h3>

                    <div class="form-group">
                        <label for="clientName">Client Name *</label>
                        <input type="text" id="clientName" required placeholder="e.g., Acme Corporation">
                        <div class="helper-text">Enter the name of your client or organization</div>
                    </div>

                    <div class="form-group">
                        <label for="industry">Industry *</label>
                        <input type="text" id="industry" required placeholder="e.g., Healthcare, Technology, Finance">
                        <div class="helper-text">What industry is this training for?</div>
                    </div>

                    <h3 style="margin: 30px 0 15px 0; color: #667eea;">Business Context</h3>

                    <div class="form-group">
                        <label for="businessContext">Business Context</label>
                        <textarea id="businessContext" rows="4" placeholder="Describe the client's current business situation, market position, and organizational context..."></textarea>
                        <div class="helper-text">What's happening in the client's business? What's their current situation?</div>
                    </div>

                    <div class="form-group">
                        <label for="businessChallenges">Business Challenges</label>
                        <textarea id="businessChallenges" rows="4" placeholder="What specific business challenges are they facing that this training should address?"></textarea>
                        <div class="helper-text">What problems or pain points is the client experiencing?</div>
                    </div>

                    <div class="form-group">
                        <label for="learningGap">Learning Gap / Knowledge Need</label>
                        <textarea id="learningGap" rows="3" placeholder="What specific knowledge or skills gap needs to be filled?"></textarea>
                        <div class="helper-text">What don't learners currently know that they need to know?</div>
                    </div>

                    <h3 style="margin: 30px 0 15px 0; color: #667eea;">Learning Design</h3>

                    <div class="form-group">
                        <label for="audience">Target Audience *</label>
                        <input type="text" id="audience" required placeholder="e.g., Healthcare professionals, IT staff, Sales team">
                        <div class="helper-text">Who will be taking this training? Include roles and experience levels.</div>
                    </div>

                    <div class="form-group">
                        <label for="objectives">Learning Objectives (one per line)</label>
                        <textarea id="objectives" rows="4" placeholder="Understand HIPAA compliance requirements&#10;Apply data privacy best practices&#10;Recognize potential security threats"></textarea>
                        <div class="helper-text">What should learners be able to DO after completing this training?</div>
                    </div>

                    <div class="form-group">
                        <label for="additionalContext">Additional Context</label>
                        <textarea id="additionalContext" rows="3" placeholder="Any other relevant information, constraints, or requirements..."></textarea>
                        <div class="helper-text">Special requirements, deadlines, existing materials, etc.</div>
                    </div>

                    <button type="submit" class="btn btn-primary">Save Brief</button>
                </form>
            </div>

            <!-- Step 3: Route Selection -->
            <div class="step-content" id="step-route">
                <h2>Select Workflow Route</h2>
                <div class="route-options">
                    <div class="route-card" onclick="selectRoute('A')">
                        <h3>Route A: Convert Existing Materials</h3>
                        <p>You have existing course materials, documentation, or reference materials that need to be reformatted for your platform.</p>
                        <ul>
                            <li>Upload existing materials</li>
                            <li>Extract and reformat content</li>
                            <li>Faster process</li>
                        </ul>
                    </div>
                    <div class="route-card" onclick="selectRoute('B')">
                        <h3>Route B: Create from Research</h3>
                        <p>Build learning content from scratch using AI research in your field.</p>
                        <ul>
                            <li>AI field research</li>
                            <li>Alternative approaches</li>
                            <li>Fresh content creation</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Step 4A: File Upload (Route A) -->
            <div class="step-content" id="step-upload">
                <h2>Upload Existing Materials</h2>
                <p style="margin-bottom: 20px;">Upload your existing course materials, training documents, or reference materials. We'll extract the content and help you reformat it.</p>

                <a href="#" class="example-download" onclick="downloadSampleFile(); return false;">
                    📥 Download Sample Training Document
                </a>

                <div class="form-group">
                    <label for="fileUpload">Upload Files (PDF, DOCX, TXT, MD)</label>
                    <input type="file" id="fileUpload" multiple accept=".pdf,.docx,.txt,.md">
                    <div class="helper-text">You can select multiple files (Max 10MB per file)</div>
                </div>
                <button class="btn btn-primary" onclick="handleFileUpload()">Process Files</button>
            </div>

            <!-- Step 4A-2: Content Review (Route A) -->
            <div class="step-content" id="step-content-review">
                <h2>Review Extracted Content</h2>
                <p style="margin-bottom: 20px;">Please review the content we extracted from your uploaded files. Does it look accurate?</p>

                <div id="content-preview" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; max-height: 400px; overflow-y: auto; white-space: pre-wrap; font-family: monospace; font-size: 0.9rem;"></div>

                <div class="navigation-buttons">
                    <button class="btn btn-back" onclick="navigateToStep('route_a_upload')">← Back</button>
                    <div style="display: flex; gap: 15px;">
                        <button class="btn btn-primary" onclick="approveContent()">✓ Looks Good - Continue</button>
                        <button class="btn btn-secondary" onclick="rejectContent()">↺ Re-upload Files</button>
                    </div>
                </div>
            </div>

            <!-- Step 4A-3: Approach Selection (Route A) -->
            <div class="step-content" id="step-approach-a">
                <h2>Select Learning Approach</h2>
                <p style="margin-bottom: 20px;">Based on your content, which learning approach would work best for your audience?</p>

                <div id="approaches-list-a" style="margin-bottom: 20px;"></div>
            </div>

            <!-- Step 4B: Research Input (Route B) -->
            <div class="step-content" id="step-research">
                <h2>Field Research</h2>
                <p style="margin-bottom: 20px;">We'll research the latest learning approaches and methodologies for your industry using AI.</p>

                <div class="helper-text" style="padding: 15px; background: #f8f9fa; border-radius: 6px; margin-bottom: 20px;">
                    <strong>What happens next:</strong>
                    <ul style="margin: 10px 0 0 20px;">
                        <li>AI will research current best practices in your industry</li>
                        <li>You'll receive 2-3 different learning approach recommendations</li>
                        <li>You'll choose the approach that best fits your needs</li>
                    </ul>
                </div>

                <div id="research-results"></div>
                <button class="btn btn-primary" onclick="conductResearch()">Start AI Research</button>
            </div>

            <!-- Step 4A-4: Arc Review (Route A) -->
            <div class="step-content" id="step-arc-review">
                <h2>Review Learning Arc</h2>
                <p style="margin-bottom: 20px;">We've created a narrative flow for your training program. Review the storyline and learning progression.</p>

                <div id="arc-display" style="background: white; padding: 25px; border-radius: 8px; border: 2px solid #667eea; margin-bottom: 20px;"></div>

                <div class="form-group">
                    <label for="arc-feedback">Feedback / Requested Changes (optional)</label>
                    <textarea id="arc-feedback" rows="4" placeholder="E.g., Start with more basic concepts, add more real-world examples..."></textarea>
                </div>

                <div class="navigation-buttons">
                    <button class="btn btn-back" onclick="navigateToStep('approach_selection_a')">← Back</button>
                    <div style="display: flex; gap: 15px;">
                        <button class="btn btn-primary" onclick="approveArc()">✓ Approve Arc</button>
                        <button class="btn btn-secondary" onclick="reviseArc()">↻ Request Changes</button>
                    </div>
                </div>
            </div>

            <!-- Step 5: Matrix Generation -->
            <div class="step-content" id="step-matrix">
                <h2>Program Matrix Generation</h2>
                <p style="margin-bottom: 20px;">Generate a structured training program based on your content and objectives.</p>

                <div class="helper-text" style="padding: 15px; background: #f8f9fa; border-radius: 6px; margin-bottom: 20px;">
                    <strong>What happens next:</strong>
                    <ul style="margin: 10px 0 0 20px;">
                        <li>We'll analyze your content and generate a program structure</li>
                        <li>The matrix will include sessions, objectives, topics, and duration</li>
                        <li>You'll be able to review and request changes before proceeding</li>
                    </ul>
                </div>

                <button class="btn btn-primary" onclick="generateMatrix()">Generate Program Matrix</button>

                <div id="matrix-loading" style="display: none; margin: 20px 0; text-align: center;">
                    <div style="display: inline-block; padding: 20px;">
                        <div class="loading-spinner"></div>
                        <p style="margin-top: 10px;">Analyzing content and generating program structure...</p>
                        <p style="font-size: 0.9rem; color: #666;">This may take 30-60 seconds</p>
                    </div>
                </div>

                <div id="matrix-display" style="display: none;"></div>
            </div>

            <!-- Step 6: Matrix Review -->
            <div class="step-content" id="step-matrix-review">
                <h2>Review Program Matrix</h2>
                <div id="matrix-review-display"></div>

                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <h3>What do you think?</h3>
                    <p style="margin-bottom: 15px;">Review the program structure above. You can approve it to continue, or request changes.</p>

                    <div class="form-group">
                        <label for="matrix-feedback">Feedback / Requested Changes (optional)</label>
                        <textarea id="matrix-feedback" rows="4" placeholder="E.g., Make the program shorter, add more advanced topics, focus more on practical exercises..."></textarea>
                    </div>

                    <div class="navigation-buttons">
                        <button class="btn btn-back" onclick="navigateToStep('arc_review')">← Back</button>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-primary" onclick="approveMatrix()">✓ Approve & Continue</button>
                            <button class="btn btn-secondary" onclick="reviseMatrix()">↻ Request Changes</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 7: Sample Content Generation -->
            <div class="step-content" id="step-sample">
                <h2>Generate Sample Content</h2>
                <p style="margin-bottom: 20px;">We'll generate one complete training session (article + quiz) as a sample for you to review before creating all content.</p>

                <button class="btn btn-primary" onclick="generateSample()">Generate Sample Session</button>

                <div id="sample-loading" style="display: none; margin: 20px 0; text-align: center;">
                    <div style="display: inline-block; padding: 20px;">
                        <div class="loading-spinner"></div>
                        <p style="margin-top: 10px;">Generating sample article and quiz...</p>
                        <p style="font-size: 0.9rem; color: #666;">This may take 30-60 seconds</p>
                    </div>
                </div>
            </div>

            <!-- Step 8: Sample Validation -->
            <div class="step-content" id="step-sample-validation">
                <h2>Review Sample Content</h2>
                <p style="margin-bottom: 20px;">Review the quality of the generated content. Does it meet your standards?</p>

                <div id="sample-content-display" style="margin-bottom: 30px;"></div>

                <div class="form-group">
                    <label for="sample-feedback">Feedback / Requested Changes (optional)</label>
                    <textarea id="sample-feedback" rows="4" placeholder="E.g., Make it more concise, add more examples, adjust difficulty level..."></textarea>
                </div>

                <div class="navigation-buttons">
                    <button class="btn btn-back" onclick="navigateToStep('matrix_review')">← Back</button>
                    <div style="display: flex; gap: 15px;">
                        <button class="btn btn-primary" onclick="approveSample()">✓ Approve - Generate All Content</button>
                        <button class="btn btn-secondary" onclick="reviseSample()">↻ Regenerate Sample</button>
                    </div>
                </div>
            </div>

            <!-- Step 9: Batch Generation -->
            <div class="step-content" id="step-batch">
                <h2>🎉 Generate All Training Content</h2>
                <p style="margin-bottom: 20px;">Great! You've approved the sample. Now we'll generate complete content (articles + quizzes) for all sessions in your program.</p>

                <div id="batch-info" style="background: #f0f3ff; padding: 20px; border-radius: 8px; border: 2px solid #667eea; margin-bottom: 30px;">
                    <h3 style="color: #667eea; margin-bottom: 10px;">What will be generated:</h3>
                    <div id="batch-summary"></div>
                </div>

                <div class="helper-text" style="padding: 15px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; margin-bottom: 20px;">
                    <strong>⏱️ Note:</strong> Generating all content may take several minutes depending on the number of sessions.
                    You'll see progress updates as each session is generated.
                </div>

                <button class="btn btn-primary" onclick="startBatchGeneration()" style="font-size: 1.1rem; padding: 15px 30px;">
                    🚀 Generate All Sessions
                </button>

                <div id="batch-progress" style="display: none; margin-top: 30px;">
                    <h3>Generation Progress</h3>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 15px 0;">
                        <div id="progress-text" style="margin-bottom: 15px; font-weight: 600; color: #667eea;"></div>
                        <div style="background: #e9ecef; height: 30px; border-radius: 15px; overflow: hidden;">
                            <div id="progress-bar-fill" style="background: linear-gradient(45deg, #667eea, #764ba2); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                        </div>
                        <div id="progress-details" style="margin-top: 15px; font-size: 0.9rem; color: #666;"></div>
                    </div>
                </div>
            </div>

            <!-- Step 10: Completed -->
            <div class="step-content" id="step-completed">
                <h2>✅ Workflow Complete!</h2>
                <p style="margin-bottom: 30px;">Congratulations! All training content has been generated successfully.</p>

                <div id="completion-summary" style="background: #d4edda; padding: 25px; border-radius: 8px; border: 2px solid #28a745; margin-bottom: 30px;">
                    <h3 style="color: #155724; margin-bottom: 15px;">📦 Generated Content</h3>
                    <div id="content-stats"></div>
                </div>

                <h3 style="margin-bottom: 15px;">Download Your Training Program</h3>
                <p style="margin-bottom: 20px;">Choose your preferred format to download the complete training program:</p>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <button class="btn btn-primary" onclick="downloadContent('json')" style="padding: 20px;">
                        📄 Download JSON<br>
                        <small style="font-weight: normal; opacity: 0.8;">Structured data format</small>
                    </button>
                    <button class="btn btn-primary" onclick="downloadContent('html')" style="padding: 20px;">
                        🌐 Download HTML<br>
                        <small style="font-weight: normal; opacity: 0.8;">Web-ready format</small>
                    </button>
                    <button class="btn btn-primary" onclick="downloadContent('markdown')" style="padding: 20px;">
                        📝 Download Markdown<br>
                        <small style="font-weight: normal; opacity: 0.8;">Easy to edit</small>
                    </button>
                </div>

                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <h4>What's Next?</h4>
                    <ul style="margin: 15px 0 0 20px;">
                        <li>Review the generated content</li>
                        <li>Import into your Learning Management System (LMS)</li>
                        <li>Make any final customizations</li>
                        <li>Launch your training program!</li>
                    </ul>
                </div>

                <button class="btn btn-secondary" onclick="startNewSession()" style="margin-top: 20px;">
                    ➕ Create Another Training Program
                </button>
            </div>

            <!-- Success Message -->
            <div id="message-container"></div>
        </div>
    </div>

    <script src="workflow-functions.js"></script>
    <script>
        let currentSessionId = null;
        let currentStep = 'sessions';

        // Load sessions on page load
        window.addEventListener('load', loadSessions);

        async function loadSessions() {
            try {
                const response = await fetch('/api/workflow');
                const sessions = await response.json();
                displaySessions(sessions);
            } catch (error) {
                console.error('Error loading sessions:', error);
            }
        }

        function displaySessions(sessions) {
            const list = document.getElementById('session-list');
            if (sessions.length === 0) {
                list.innerHTML = '<li style="padding: 20px; text-align: center; color: #666;">No sessions yet. Create one to get started.</li>';
                return;
            }

            list.innerHTML = sessions.map(session => `
                <li class="session-item">
                    <div class="session-info" onclick="loadSession('${session.id}')">
                        <strong>${session.client_name}</strong> - ${session.industry}
                        <br>
                        <small>Status: ${session.status} | Step: ${session.current_step}</small>
                    </div>
                    <button class="btn-delete" onclick="deleteSession('${session.id}', event)">Delete</button>
                </li>
            `).join('');
        }

        function showNewSessionForm() {
            currentSessionId = null;
            document.getElementById('brief-form').reset();
            showStep('brief');
        }

        async function deleteSession(sessionId, event) {
            // Prevent triggering the parent onclick
            if (event) {
                event.stopPropagation();
            }

            if (!confirm('Are you sure you want to delete this session? This cannot be undone.')) {
                return;
            }

            showLoading(true);

            try {
                const response = await fetch(`/api/workflow/${sessionId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showMessage('Session deleted successfully!', 'success');
                    // Reload sessions list
                    await loadSessions();
                } else {
                    const data = await response.json();
                    showMessage(data.error || 'Error deleting session', 'error');
                }
            } catch (error) {
                console.error('Error deleting session:', error);
                showMessage('Error deleting session: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function loadSession(sessionId) {
            try {
                const response = await fetch(`/api/workflow/${sessionId}`);
                const data = await response.json();
                currentSessionId = sessionId;
                showStep(data.session.current_step);
            } catch (error) {
                console.error('Error loading session:', error);
                showMessage('Error loading session', 'error');
            }
        }

        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));

            // Show current step
            const stepMap = {
                'brief': 'step-brief',
                'route_selection': 'step-route',
                'route_a_upload': 'step-upload',
                'content_review': 'step-content-review',
                'approach_selection_a': 'step-approach-a',
                'arc_generation': 'step-arc-review', // Show arc review page after generation
                'arc_review': 'step-arc-review',
                'route_b_research': 'step-research',
                'approach_selection_b': 'step-research',
                'matrix_generation': 'step-matrix',
                'matrix_review': 'step-matrix-review',
                'sample_generation': 'step-sample',
                'sample_validation': 'step-sample-validation',
                'batch_generation': 'step-batch',
                'completed': 'step-completed',
                'sessions': 'step-sessions'
            };

            const stepId = stepMap[step] || 'step-sessions';
            document.getElementById(stepId).classList.add('active');

            // Auto-load data for steps that need it
            if (step === 'content_review') {
                loadContentReview();
            }

            if (step === 'approach_selection_a') {
                loadApproachesIfNeeded();
            }

            if (step === 'arc_review') {
                loadArcIfNeeded();
            }

            if (step === 'matrix_review') {
                loadMatrixIfNeeded();
            }

            if (step === 'sample_validation') {
                loadSampleIfNeeded();
            }

            // Load batch summary when showing batch step
            if (step === 'batch_generation') {
                loadBatchSummary();
            }

            // Load completion stats when showing completed step
            if (step === 'completed') {
                loadCompletionStats();
            }

            // Update progress bar
            updateProgressBar(step);
        }

        // Track completed steps
        let completedSteps = new Set();

        function updateProgressBar(currentStep) {
            // Update active state
            document.querySelectorAll('.progress-step').forEach(step => {
                step.classList.remove('active');
            });

            // Map current step to progress bar step
            const stepProgressMap = {
                'brief': 'brief',
                'route_selection': 'route',
                'route_a_upload': 'prepare',
                'content_review': 'prepare',
                'approach_selection_a': 'prepare',
                'arc_generation': 'prepare',
                'arc_review': 'prepare',
                'route_b_research': 'prepare',
                'approach_selection_b': 'prepare',
                'matrix_generation': 'matrix',
                'matrix_review': 'matrix',
                'sample_generation': 'sample',
                'sample_validation': 'sample',
                'batch_generation': 'complete',
                'completed': 'complete'
            };

            const progressStep = stepProgressMap[currentStep];
            if (progressStep) {
                // Mark current as active
                const activeElement = document.querySelector(`[data-step="${progressStep}"]`);
                if (activeElement) {
                    activeElement.classList.add('active');
                }

                // Mark all previous steps as completed and enable them
                const stepOrder = ['brief', 'route', 'prepare', 'matrix', 'sample', 'complete'];
                const currentIndex = stepOrder.indexOf(progressStep);

                stepOrder.forEach((step, index) => {
                    const element = document.querySelector(`[data-step="${step}"]`);
                    if (element) {
                        if (index < currentIndex) {
                            element.classList.add('completed');
                            element.classList.remove('disabled');
                            completedSteps.add(step);
                        } else if (index === currentIndex) {
                            element.classList.remove('disabled', 'completed');
                        }
                    }
                });
            }
        }

        function navigateToStep(targetStep) {
            // Check if step is disabled
            const element = document.querySelector(`[data-target="${targetStep}"]`);
            if (element && element.classList.contains('disabled')) {
                showMessage('This step is not yet available', 'error');
                return;
            }

            if (!currentSessionId && targetStep !== 'brief') {
                showMessage('Please create a session first', 'error');
                return;
            }

            // Navigate to the step
            showStep(targetStep);
        }

        document.getElementById('brief-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const brief = {
                clientName: document.getElementById('clientName').value,
                industry: document.getElementById('industry').value,
                objectives: document.getElementById('objectives').value.split('\n').filter(o => o.trim()),
                audience: document.getElementById('audience').value,
                // New fields for business context
                businessContext: document.getElementById('businessContext').value,
                businessChallenges: document.getElementById('businessChallenges').value,
                learningGap: document.getElementById('learningGap').value,
                additionalContext: document.getElementById('additionalContext').value
            };

            showLoading(true);

            try {
                // Send in the format the backend expects
                const response = await fetch('/api/workflow', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        clientName: brief.clientName,
                        industry: brief.industry,
                        brief: brief  // Nest the full brief object with all new fields
                    })
                });

                const data = await response.json();
                currentSessionId = data.sessionId;
                showMessage('Brief saved successfully!', 'success');
                showStep('route_selection');
            } catch (error) {
                console.error('Error saving brief:', error);
                showMessage('Error saving brief', 'error');
            } finally {
                showLoading(false);
            }
        });

        async function selectRoute(route) {
            if (!currentSessionId) {
                showMessage('Please create a session first', 'error');
                return;
            }

            showLoading(true);

            try {
                const response = await fetch(`/api/workflow/${currentSessionId}/route`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ route })
                });

                const data = await response.json();
                showMessage(`Route ${route} selected!`, 'success');
                showStep(data.nextStep);
            } catch (error) {
                console.error('Error selecting route:', error);
                showMessage('Error selecting route', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function handleFileUpload() {
            const fileInput = document.getElementById('fileUpload');
            const files = fileInput.files;

            if (files.length === 0) {
                showMessage('Please select files to upload', 'error');
                return;
            }

            showLoading(true);

            try {
                // Use FormData to send actual files
                const formData = new FormData();
                for (let i = 0; i < files.length; i++) {
                    formData.append('files', files[i]);
                }

                const response = await fetch(`/api/workflow/${currentSessionId}/upload`, {
                    method: 'POST',
                    body: formData
                    // Note: Don't set Content-Type header, browser will set it with boundary
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage(`Files uploaded successfully! Processed ${data.filesCount} files.`, 'success');
                    // Load and show content for review
                    await loadContentReview();
                    // Move to next step based on response
                    if (data.nextStep) {
                        setTimeout(() => showStep(data.nextStep), 2000);
                    }
                } else {
                    showMessage(data.error || 'Error uploading files', 'error');
                }
            } catch (error) {
                console.error('Error uploading files:', error);
                showMessage('Error uploading files: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function conductResearch() {
            if (!currentSessionId) return;

            showLoading(true);

            try {
                const response = await fetch(`/api/workflow/${currentSessionId}/research`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();

                if (response.ok) {
                    // Display research results
                    displayResearchResults(data.research);
                    showMessage('Research completed! Review the approaches below.', 'success');
                } else {
                    showMessage(data.error || 'Error conducting research', 'error');
                }
            } catch (error) {
                console.error('Error conducting research:', error);
                showMessage('Error conducting research: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        function displayResearchResults(research) {
            const container = document.getElementById('research-results');

            let html = '<div style="margin: 20px 0;">';
            html += '<h3>Latest Developments</h3>';
            html += '<ul>';
            research.latestDevelopments.forEach(dev => {
                html += `<li>${dev}</li>`;
            });
            html += '</ul>';

            html += '<h3 style="margin-top: 20px;">Recommended Approaches</h3>';
            research.approaches.forEach((approach, index) => {
                const isRecommended = approach.id === research.recommendation.approachId;
                html += `
                    <div style="border: 2px solid ${isRecommended ? '#667eea' : '#e1e5e9'};
                                padding: 15px; margin: 15px 0; border-radius: 8px;
                                background: ${isRecommended ? '#f0f3ff' : 'white'};">
                        <h4 style="color: #667eea;">${approach.name} ${isRecommended ? '⭐ Recommended' : ''}</h4>
                        <p>${approach.description}</p>
                        <p><strong>Methodology:</strong> ${approach.methodology}</p>
                        <p><strong>Best for:</strong> ${approach.bestFor.join(', ')}</p>
                        <button class="btn btn-primary" style="margin-top: 10px;"
                                onclick="selectApproach('${approach.id}')">
                            Select This Approach
                        </button>
                    </div>
                `;
            });
            html += '</div>';

            container.innerHTML = html;
        }

        async function selectApproach(approachId) {
            if (!currentSessionId) return;

            showLoading(true);

            try {
                const response = await fetch(`/api/workflow/${currentSessionId}/approach`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ approach: approachId })
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage('Approach selected! Moving to next step...', 'success');
                    if (data.nextStep) {
                        setTimeout(() => showStep(data.nextStep), 2000);
                    }
                } else {
                    showMessage(data.error || 'Error selecting approach', 'error');
                }
            } catch (error) {
                console.error('Error selecting approach:', error);
                showMessage('Error selecting approach: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('active', show);
        }

        function showMessage(message, type) {
            const container = document.getElementById('message-container');
            const className = type === 'error' ? 'error-message' : 'success-message';
            container.innerHTML = `<div class="${className}">${message}</div>`;
            setTimeout(() => container.innerHTML = '', 5000);
        }

        // Upload and process briefing document
        async function uploadBriefDocument() {
            const fileInput = document.getElementById('briefDocument');
            const file = fileInput.files[0];

            if (!file) {
                showMessage('Please select a briefing document to upload', 'error');
                return;
            }

            showLoading(true);

            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch('/api/workflow/brief/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    // Auto-fill form fields with extracted data
                    if (data.brief.clientName) document.getElementById('clientName').value = data.brief.clientName;
                    if (data.brief.industry) document.getElementById('industry').value = data.brief.industry;
                    if (data.brief.businessContext) document.getElementById('businessContext').value = data.brief.businessContext;
                    if (data.brief.businessChallenges) document.getElementById('businessChallenges').value = data.brief.businessChallenges;
                    if (data.brief.learningGap) document.getElementById('learningGap').value = data.brief.learningGap;
                    if (data.brief.audience) document.getElementById('audience').value = data.brief.audience;
                    if (data.brief.objectives) document.getElementById('objectives').value = Array.isArray(data.brief.objectives) ? data.brief.objectives.join('\n') : data.brief.objectives;
                    if (data.brief.additionalContext) document.getElementById('additionalContext').value = data.brief.additionalContext;

                    showMessage('Briefing document processed! Review and edit the extracted information.', 'success');
                } else {
                    showMessage(data.error || 'Error processing briefing document', 'error');
                }
            } catch (error) {
                console.error('Error uploading briefing document:', error);
                showMessage('Error uploading briefing document: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Fill example brief data
        function fillExampleBrief() {
            document.getElementById('clientName').value = 'TechCorp Industries';
            document.getElementById('industry').value = 'Healthcare Technology';
            document.getElementById('businessContext').value = 'TechCorp is a mid-size healthcare IT provider experiencing rapid growth. They recently acquired two smaller companies and are integrating systems while maintaining HIPAA compliance across all platforms.';
            document.getElementById('businessChallenges').value = `Recent security audit revealed gaps in employee knowledge about data protection
Staff from acquired companies not familiar with TechCorp's security protocols
Increasing regulatory scrutiny requiring documented training programs
Remote work has created new data security challenges`;
            document.getElementById('learningGap').value = 'Many employees lack comprehensive understanding of HIPAA requirements, especially newer staff and those from acquired companies. Need to standardize knowledge across entire organization.';
            document.getElementById('objectives').value = `Understand HIPAA compliance requirements
Apply data privacy and security best practices
Recognize and respond to potential security threats
Implement secure patient data handling procedures`;
            document.getElementById('audience').value = 'Healthcare IT professionals and administrators (experience levels: junior to senior)';
            document.getElementById('additionalContext').value = 'Training must be completed within 60 days. Prefer modular approach so employees can complete in stages. Will integrate into existing LMS.';
            showMessage('Example data filled! You can edit it before saving.', 'success');
        }

        // Generate matrix
        async function generateMatrix() {
            if (!currentSessionId) return;

            document.getElementById('matrix-loading').style.display = 'block';
            showLoading(true);

            try {
                const response = await fetch(`/api/workflow/${currentSessionId}/matrix/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();

                if (response.ok) {
                    displayMatrix(data.matrix);
                    showMessage('Program matrix generated successfully!', 'success');
                    setTimeout(() => showStep(data.nextStep), 2000);
                } else {
                    showMessage(data.error || 'Error generating matrix', 'error');
                }
            } catch (error) {
                console.error('Error generating matrix:', error);
                showMessage('Error generating matrix: ' + error.message, 'error');
            } finally {
                showLoading(false);
                document.getElementById('matrix-loading').style.display = 'none';
            }
        }

        // Display matrix
        function displayMatrix(matrix) {
            const container = document.getElementById('matrix-review-display');

            let html = `
                <div style="background: white; padding: 25px; border-radius: 8px; border: 2px solid #667eea;">
                    <h3 style="color: #667eea; margin-bottom: 10px;">${matrix.programTitle}</h3>
                    <p style="margin-bottom: 20px; color: #666;">${matrix.overview}</p>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                        <div><strong>Total Sessions:</strong> ${matrix.totalSessions}</div>
                        <div><strong>Target Audience:</strong> ${matrix.targetAudience}</div>
                    </div>
            `;

            matrix.sessions.forEach(session => {
                html += `
                    <div class="matrix-session">
                        <h4>Session ${session.sessionNumber}: ${session.title}</h4>
                        <p><strong>Duration:</strong> ${session.estimatedDuration}</p>

                        <div style="margin-top: 15px;">
                            <strong>Learning Objectives:</strong>
                            <ul>${session.objectives.map(obj => `<li>${obj}</li>`).join('')}</ul>
                        </div>

                        <div style="margin-top: 15px;">
                            <strong>Topics Covered:</strong>
                            <ul>${session.topics.map(topic => `<li>${topic}</li>`).join('')}</ul>
                        </div>

                        <div style="margin-top: 15px;">
                            <strong>Key Takeaways:</strong>
                            <ul>${session.keyTakeaways.map(take => `<li>${take}</li>`).join('')}</ul>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        // Approve matrix
        async function approveMatrix() {
            if (!currentSessionId) return;

            showLoading(true);

            try {
                const response = await fetch(`/api/workflow/${currentSessionId}/matrix/review`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        decision: 'approve',
                        feedback: document.getElementById('matrix-feedback').value
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage('Matrix approved! Moving to sample generation...', 'success');
                    setTimeout(() => showStep(data.nextStep), 2000);
                } else {
                    showMessage(data.error || 'Error approving matrix', 'error');
                }
            } catch (error) {
                console.error('Error approving matrix:', error);
                showMessage('Error approving matrix: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Request matrix revision
        async function reviseMatrix() {
            if (!currentSessionId) return;

            const feedback = document.getElementById('matrix-feedback').value;
            if (!feedback || feedback.trim() === '') {
                showMessage('Please provide feedback for the requested changes', 'error');
                return;
            }

            showLoading(true);

            try {
                const response = await fetch(`/api/workflow/${currentSessionId}/matrix/regenerate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ feedback })
                });

                const data = await response.json();

                if (response.ok) {
                    displayMatrix(data.matrix);
                    document.getElementById('matrix-feedback').value = '';
                    showMessage('Matrix updated based on your feedback!', 'success');
                } else {
                    showMessage(data.error || 'Error regenerating matrix', 'error');
                }
            } catch (error) {
                console.error('Error regenerating matrix:', error);
                showMessage('Error regenerating matrix: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Load batch summary
        async function loadBatchSummary() {
            if (!currentSessionId) return;

            try {
                const response = await fetch(`/api/workflow/${currentSessionId}`);
                const data = await response.json();

                if (data.data && data.data.programMatrix) {
                    const programMatrix = data.data.programMatrix;

                    if (programMatrix) {
                        const summaryHtml = `
                            <p><strong>Program:</strong> ${programMatrix.programTitle}</p>
                            <p><strong>Total Sessions:</strong> ${programMatrix.totalSessions}</p>
                            <p><strong>Target Audience:</strong> ${programMatrix.targetAudience}</p>
                            <p style="margin-top: 15px;">Each session will include:</p>
                            <ul style="margin: 10px 0 0 20px;">
                                <li>Complete training article (800-1200 words)</li>
                                <li>Multiple-choice quiz questions</li>
                                <li>Explanations for correct answers</li>
                            </ul>
                        `;
                        document.getElementById('batch-summary').innerHTML = summaryHtml;
                    }
                }
            } catch (error) {
                console.error('Error loading batch summary:', error);
            }
        }

        // Start batch generation
        async function startBatchGeneration() {
            if (!currentSessionId) return;

            // Show progress UI
            document.getElementById('batch-progress').style.display = 'block';
            document.getElementById('progress-text').textContent = 'Starting batch generation...';
            document.getElementById('progress-bar-fill').style.width = '0%';
            document.getElementById('progress-details').textContent = 'Preparing to generate all sessions';

            showLoading(true);

            try {
                const response = await fetch(`/api/workflow/${currentSessionId}/batch/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();

                if (response.ok) {
                    // Update progress to 100%
                    document.getElementById('progress-text').textContent = 'Batch generation complete!';
                    document.getElementById('progress-bar-fill').style.width = '100%';
                    document.getElementById('progress-details').textContent =
                        `Successfully generated ${data.totalSessions} training sessions`;

                    showMessage('All content generated successfully!', 'success');

                    // Move to completion step after a short delay
                    setTimeout(() => {
                        if (data.nextStep) {
                            showStep(data.nextStep);
                        }
                    }, 2000);
                } else {
                    showMessage(data.error || 'Error generating batch content', 'error');
                    document.getElementById('progress-text').textContent = 'Generation failed';
                    document.getElementById('progress-details').textContent = data.error || 'An error occurred';
                }
            } catch (error) {
                console.error('Error generating batch content:', error);
                showMessage('Error generating batch content: ' + error.message, 'error');
                document.getElementById('progress-text').textContent = 'Generation failed';
                document.getElementById('progress-details').textContent = error.message;
            } finally {
                showLoading(false);
            }
        }

        // Load completion statistics
        async function loadCompletionStats() {
            if (!currentSessionId) return;

            try {
                const response = await fetch(`/api/workflow/${currentSessionId}`);
                const data = await response.json();

                if (data.data && data.data.allContent) {
                    const allContent = data.data.allContent;

                    if (allContent) {
                        const statsHtml = `
                            <p><strong>Program Title:</strong> ${allContent.programTitle}</p>
                            <p><strong>Total Sessions:</strong> ${allContent.totalSessions}</p>
                            <p><strong>Sessions Generated:</strong> ${allContent.sessions.length}</p>
                            <p><strong>Target Audience:</strong> ${allContent.metadata.targetAudience}</p>
                            <p><strong>Client:</strong> ${allContent.metadata.clientName}</p>
                            <p><strong>Industry:</strong> ${allContent.metadata.industry}</p>
                            <p><strong>Generated:</strong> ${new Date(allContent.generatedAt).toLocaleString()}</p>
                        `;
                        document.getElementById('content-stats').innerHTML = statsHtml;
                    }
                }
            } catch (error) {
                console.error('Error loading completion stats:', error);
            }
        }

        // Download content in specified format
        async function downloadContent(format) {
            if (!currentSessionId) return;

            showLoading(true);

            try {
                const response = await fetch(`/api/workflow/${currentSessionId}/batch/download/${format}`);

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;

                    // Set filename based on format
                    const extension = format === 'json' ? 'json' : (format === 'html' ? 'html' : 'md');
                    a.download = `training-program.${extension}`;

                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);

                    showMessage(`Training program downloaded as ${format.toUpperCase()}!`, 'success');
                } else {
                    const data = await response.json();
                    showMessage(data.error || 'Error downloading content', 'error');
                }
            } catch (error) {
                console.error('Error downloading content:', error);
                showMessage('Error downloading content: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Start a new workflow session
        function startNewSession() {
            showStep('sessions');
            loadSessions();
        }

        // Download sample training document
        function downloadSampleFile() {
            const sampleContent = `HEALTHCARE IT SECURITY TRAINING MATERIALS

Module 1: HIPAA Compliance Fundamentals

Overview:
The Health Insurance Portability and Accountability Act (HIPAA) establishes national standards for protecting sensitive patient health information. This module covers the key requirements and best practices for HIPAA compliance in healthcare IT systems.

Learning Objectives:
- Understand the core requirements of HIPAA Privacy and Security Rules
- Identify Protected Health Information (PHI) in various contexts
- Implement appropriate safeguards for electronic PHI (ePHI)

Key Concepts:

1. Protected Health Information (PHI)
   - Any individually identifiable health information
   - Includes demographic data, medical histories, test results, insurance information
   - Must be protected whether transmitted, stored, or maintained

2. HIPAA Security Rule Requirements
   - Administrative safeguards: policies, procedures, training
   - Physical safeguards: facility access controls, workstation security
   - Technical safeguards: access controls, encryption, audit controls

3. Risk Assessment
   - Regular evaluation of potential risks to ePHI
   - Documentation of security measures
   - Continuous monitoring and updating

Best Practices:
- Use strong authentication and access controls
- Encrypt data in transit and at rest
- Maintain detailed audit logs
- Conduct regular security awareness training
- Implement incident response procedures

Module 2: Data Privacy Best Practices

Overview:
Effective data privacy goes beyond compliance to build trust with patients and protect organizational reputation. This module explores practical strategies for maintaining data privacy in healthcare settings.

Key Topics:
- Minimum necessary standard
- Authorization and consent procedures
- Breach notification requirements
- Vendor management and Business Associate Agreements

Practical Scenarios:
1. Email Security: When can PHI be sent via email? What safeguards are required?
2. Mobile Devices: How to secure PHI on smartphones and tablets
3. Remote Access: Best practices for telehealth and remote work

Module 3: Security Threat Recognition

Common Threats:
- Phishing attacks targeting healthcare credentials
- Ransomware attacks on medical facilities
- Insider threats and unauthorized access
- Lost or stolen devices containing PHI

Response Procedures:
1. Immediate containment of suspected breaches
2. Notification to security team and compliance officer
3. Documentation of incident details
4. Investigation and remediation
5. Notification to affected individuals if required

Assessment Questions:
1. What constitutes a HIPAA violation?
2. How should you respond to a suspected data breach?
3. What are the penalties for non-compliance?

Additional Resources:
- HHS Office for Civil Rights guidance
- NIST Cybersecurity Framework
- Healthcare-specific security standards`;

            const blob = new Blob([sampleContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sample-healthcare-training.txt';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            showMessage('Sample file downloaded! You can upload it in the next step.', 'success');
        }
    </script>
</body>
</html>
